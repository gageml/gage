# Output Summary

By default, Gage scans run output for summary data if a summary file
isn't otherwise written.

This behavior can be disabled by setting the op def `output-summary`
attribute to false or an empty string.

If output summary is true or not specified, Gage uses a default pattern.

    >>> from gage._internal import run_util

    >>> run_util._DEFAULT_OUTPUT_SUMMARY_PATTERN
    '--- summary ---(.*)---'

## Use All Output for Summary

The example `summary` provides various summary related operations.

    >>> use_example("summary")

    >>> run("gage ops")  # +wildcard
    | operation            | description                       |
    |----------------------|-----------------------------------|
    ...
    | output-summary       | Use output to print summary       |
    | output-summary-2     | Alt of output-summary using       |
    |                      | default pattern                   |
    | output-summary-3     | Alt of output summary using       |
    |                      | custom pattern                    |
    | output-summary-4     | Alt of output summary using       |
    |                      | invalid pattern                   |
    <0>

`output-summary-1` uses the entire output generated by a run to create
the run summary.

    >>> run("gage run output-summary -y")
    {
      "metrics": {
        "i": 1,
        "f": 2.3
      },
      "attributes": {
        "s": "abc"
      }
    }
    <0>

    >>> run("gage show")  # +parse +panel
    {:run_id}
    | summary:output-summary                         completed |
    ⤶
    {}
                              Summary
    | name        |value          |type                        |
    | ------------|---------------|--------------------------- |
    | s           |abc            |attribute                   |
    | f           |2.3            |metric                      |
    | i           |1              |metric                      |
    ⤶
    {}
                               Output
    | {                                                        |
    |   "metrics": {                                           |
    |     "i": 1,                                              |
    |     "f": 2.3                                             |
    |   },                                                     |
    |   "attributes": {                                        |
    |     "s": "abc"                                           |
    |   }                                                      |
    | }                                                        |
    <0>

`output-summary-2` uses the default output summary pattern.

    >>> run("gage run output-summary-2 -y")
    Running something
    Calculating something
    --- summary ---
    {
      "metrics": {
        "i": 2,
        "f": 3.4
      },
      "attributes": {
        "s": "def"
      }
    }
    ---
    <0>

    >>> run("gage show")  # +parse +panel
    {:run_id}
    | summary:output-summary-2                       completed |
    ⤶
    {}
                              Summary
    | name        |value          |type                        |
    | ------------|---------------|--------------------------- |
    | s           |def            |attribute                   |
    | f           |3.4            |metric                      |
    | i           |2              |metric                      |
    ⤶
    {}
                               Output
    | Running something                                        |
    | Calculating something                                    |
    | --- summary ---                                          |
    | {                                                        |
    |   "metrics": {                                           |
    |     "i": 2,                                              |
    |     "f": 3.4                                             |
    |   },                                                     |
    |   "attributes": {                                        |
    |     "s": "def"                                           |
    |   }                                                      |
    | }                                                        |
    | ---                                                      |
    <0>

`output-summary-3` is a futuristic "nice to have" implementation of
output summary that uses a flat YAML structure. This example fails
because Gage currently requires that output summary be encoded as JSON.

    >>> run("gage run output-summary-3 -y")
    Running something
    Calculating something
    Summary:
      i: 3
      f: 3.4
      s: def
    ⤶
    Something else
    <0>

View the runner log.

    >>> run("gage cat --meta --path log/runner")  # +parse
    {}
    {:isodate} Checking output for summary pattern 'Summary:\n(.*?)\n\n'
    {:isodate} Found summary output
    {:isodate} Error decoding output summary: Expecting value: line 1 column 3 (char 2)
    {}
    <0>

`output-summary-4` intentionally has an error in the output summary
pattern.

    >>> run("gage run output-summary-4 -y")  # +parse
    Running something
    Calculating something
    --- summary ---
    {
      "metrics": {
        "i": 2,
        "f": 3.4
      },
      "attributes": {
        "s": "def"
      }
    }
    ---
    <0>

View the runner log.

    >>> run("gage cat --meta --path log/runner")  # +parse
    {}
    {:isodate} Checking output for summary pattern '--- summary ---'
    {:isodate} Found summary output
    {:isodate} Error in output summary pattern '--- summary ---': must capture a group
    {}
    <0>
